//
//  Activiti.swift
//  mobile-inbox
//
//  Created by Evgeniy Sergeyev on 02/06/2017.
//  Copyright Â© 2017 OpenIAM. All rights reserved.
//

import Foundation

/// ////////////////////////////////////////////////////////////////////
/// OpenIAM API Wrappers
/// ////////////////////////////////////////////////////////////////////



/// GET http://lnx2.openiamdemo.com/selfservice/rest/api/activiti/tasks/assigned?from=0&size=20&sortBy=name&orderBy=ASC HTTP/1.1

/// search GET http://lnx1.openiamdemo.com/selfservice/rest/api/activiti/tasks/assigned?size=20&sortBy=name&orderBy=ASC&fromDate=06/01/2017&description=New&from=0&size=20&sortBy=name&orderBy=ASC HTTP/1.1

/// GET http://lnx1.openiamdemo.com/selfservice/rest/api/activiti/tasks/assigned?size=20&sortBy=name&orderBy=ASC&from=0&size=20&sortBy=name&orderBy=ASC HTTP/1.1

/// GET http://lnx1.openiamdemo.com/selfservice/rest/api/users/getUserFormAttributes HTTP/1.1
/// {"requesterId":"3000","userSearchModel":{"status":0,"errorList":null,"redirectURL":null,"successToken":null,"successMessage":null,"contextValues":null,"objectId":null,"possibleErrors":null,"jobCode":null,"requesterId":null,"lastName":null,"firstName":null,"nickName":null,"principal":null,"email":null,"roleIds":null,"groupIds":null,"userStatus":null,"organizationIds":null,"phoneCode":null,"phoneNumber":null,"accountStatus":null,"attributeName":null,"attributeElementId":null,"attributeValue":null,"employeeId":null,"resourceId":null,"employeeType":null,"from":0,"size":0,"targetUserId":null,"maidenName":null,"fromDirectoryLookup":false,"deepCopy":false,"sortBy":null,"orderBy":null,"lightSearch":false,"empty":true,"error":false},"statusList":null,"userSecondaryStatusList":null,"attributeList":null,"organizationList":null,"groupList":null,"roleList":null,"applications":null,"employeeTypes":null,"additionalSearchCriteria":[],"pageNumber":0,"size":10}



/// POST http://lnx1.openiamdemo.com/selfservice/rest/api/users/search/metadata HTTP/1.1
/// ["name","principal","email","userStatus","accountStatus"]

/// POST http://lnx1.openiamdemo.com/webconsole/rest/api/users/search HTTP/1.1
///    {"error":null,"size":11,"beans":[{"id":"00000000501a005c01501adf93bb01d3","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"BlazeMeter Test","phone":null,"email":"evgeniy.sergeev@openiam.com","userStatus":"ACTIVE","accountStatus":null,"principal":"BlazeMeter02","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"00000000501a005c01501ade6c8201aa","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"BlazeMeter Test","phone":null,"email":"evgeniy.sergeev@openiam.com","userStatus":"ACTIVE","accountStatus":null,"principal":"BlazeMeter01","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"000000005008e750015014ab41e0186a","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"BlazeMeter Test","phone":null,"email":"evgeniy.sergeev@openiam.com","userStatus":"ACTIVE","accountStatus":null,"principal":"BlazeMeter.Test","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"0000000055551b5401555dabd33102a3","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"EvgeniyTest Test","phone":null,"email":null,"userStatus":"ACTIVE","accountStatus":null,"principal":"evgeniyTestEula","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"0000000055551b5401555dc7f17b02dd","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"EvgeniyTest Test","phone":null,"email":null,"userStatus":"ACTIVE","accountStatus":null,"principal":"EvgeniyTest.Test","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"ff8080815c1093c4015c1735033005f1","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"Lev Test","phone":null,"email":null,"userStatus":"ACTIVE","accountStatus":null,"principal":"lev.bornovalov","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"ff8080815a9583eb015aa39b69b908b9","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"Test Test","phone":null,"email":"suneet_shah@openiam.com","userStatus":"PENDING_INITIAL_LOGIN","accountStatus":null,"principal":"Test.Test","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"ff8080815a488abb015a4cbb73950601","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"TEst Test1","phone":null,"email":null,"userStatus":"ACTIVE","accountStatus":null,"principal":"googleHelp","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"00000000586e080e01586f0bc7dd0563","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"G TestUser","phone":null,"email":null,"userStatus":"ACTIVE","accountStatus":null,"principal":"getestUser","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"00000000506fb7d3015084b6a88c0a84","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"ie test","phone":null,"email":"winviji@gmail.com","userStatus":"ACTIVE","accountStatus":null,"principal":"ie.test","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null},{"id":"ff8080815a722362015a722c986e0008","hasChild":false,"beanType":"UserBean","classification":null,"middleInit":null,"name":"time test","phone":null,"email":null,"userStatus":"PENDING_INITIAL_LOGIN","accountStatus":null,"principal":"anttimetest","organization":null,"department":null,"division":null,"title":null,"employeeId":null,"startDate":null,"organizations":null,"companies":null,"orgs":null}],"emptySearchBean":false}



/// Referer: http://lnx2.openiamdemo.com/selfservice/myTasks.html?OPENIAM_MENU_ID=SS_TOP_MENU_INBOX
/// Success example:
/// {
///     "beans" : [ ],
///     "pageSize" : 20,
///     "page" : 0,
///     "from" : 0,
///     "size" : 0,
///     "emptySearchBean" : false,
///     "error" : null
/// }
///
/// from lnx1 empty response:
/// {"error":null,"size":0,"beans":[],"emptySearchBean":false}
///
/// from lnx1 response with data:
/// {"error":null,"size":24,"beans":[{"id":"16235","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"16223","processInstanceId":"16210","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for selfservice100 Test","createdTime":1495549512643,"endDate":null},{"id":"15726","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"15714","processInstanceId":"15701","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for shrawani karpe","createdTime":1494483718314,"endDate":null},{"id":"15525","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"15513","processInstanceId":"15500","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for ABC0 ABC2","createdTime":1490016216131,"endDate":null},{"id":"15499","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"15487","processInstanceId":"15474","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for ABC0 ABC2","createdTime":1490012957315,"endDate":null},{"id":"15473","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15456","processInstanceId":"15441","processDefinitionId":"editUser:21:13071","description":"Edit User Lana Lana","createdTime":1489751356560,"endDate":null},{"id":"15440","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15428","processInstanceId":"15415","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for selfservice100 Test","createdTime":1489751296845,"endDate":null},{"id":"15414","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15397","processInstanceId":"15382","processDefinitionId":"editUser:21:13071","description":"Edit User Lana Lana","createdTime":1489750477418,"endDate":null},{"id":"15381","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15369","processInstanceId":"15356","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for selfservice100 Test","createdTime":1489750415750,"endDate":null},{"id":"15355","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15338","processInstanceId":"15323","processDefinitionId":"editUser:21:13071","description":"Edit User Lana Lana","createdTime":1489743964592,"endDate":null},{"id":"15322","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15310","processInstanceId":"15297","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for selfservice100 Test","createdTime":1489743896978,"endDate":null},{"id":"15223","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"15211","processInstanceId":"15198","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for ABC0 ABC2","createdTime":1489673791299,"endDate":null},{"id":"15124","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"15112","processInstanceId":"15099","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for ABC0 ABC2","createdTime":1489509875220,"endDate":null},{"id":"15098","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"15086","processInstanceId":"15073","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for ABC0 ABC2","createdTime":1489506141134,"endDate":null},{"id":"15072","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15055","processInstanceId":"15040","processDefinitionId":"editUser:21:13071","description":"Edit User Lana Lana","createdTime":1489080806018,"endDate":null},{"id":"15039","hasChild":false,"beanType":"TaskWrapperBean","name":"Vijaylakshmi.Iyer","deletable":true,"parentTaskId":null,"executionId":"15027","processInstanceId":"15014","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for selfservice100 Test","createdTime":1489080741692,"endDate":null},{"id":"14465","hasChild":false,"beanType":"TaskWrapperBean","name":"Vitaliya.Zhuravleva1","deletable":true,"parentTaskId":null,"executionId":"14453","processInstanceId":"14440","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for testassos testassos","createdTime":1488446752391,"endDate":null},{"id":"14439","hasChild":false,"beanType":"TaskWrapperBean","name":"Vitaliya.Zhuravleva1","deletable":true,"parentTaskId":null,"executionId":"14427","processInstanceId":"14414","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for testassos testassos","createdTime":1488446700403,"endDate":null},{"id":"14387","hasChild":false,"beanType":"TaskWrapperBean","name":"Vitaliya.Zhuravleva1","deletable":true,"parentTaskId":null,"executionId":"14375","processInstanceId":"14362","processDefinitionId":"newHireWithApprovalProcess:21:13083","description":"New Hire Request for testassos testassos","createdTime":1488446555644,"endDate":null},{"id":"14361","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"14349","processInstanceId":"14336","processDefinitionId":"selfRegistration:21:13075","description":"Self Registration Request for ABC0 ABC2","createdTime":1488360545437,"endDate":null},{"id":"13385","hasChild":false,"beanType":"TaskWrapperBean","name":"","deletable":true,"parentTaskId":null,"executionId":"13370","processInstanceId":"13355","processDefinitionId":"newGroup:21:13069","description":"Edit Group vTestGroup2","createdTime":1485780261709,"endDate":null}],"emptySearchBean":false}


class Activiti {
    let assignedTasksPath = "/selfservice/rest/api/activiti/tasks/assigned"
    let candidateTasksPath = "/selfservice/rest/api/activiti/tasks/candidate"

    let restApi: RestApi!

    #if DEBUG
    let LNX2_WORKAROUND = "{\"error\":null,\"size\":24,\"beans\":[{\"id\":\"16235\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"16223\",\"processInstanceId\":\"16210\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for selfservice100 Test\",\"createdTime\":1495549512643,\"endDate\":null},{\"id\":\"15726\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15714\",\"processInstanceId\":\"15701\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for shrawani karpe\",\"createdTime\":1494483718314,\"endDate\":null},{\"id\":\"15525\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15513\",\"processInstanceId\":\"15500\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for ABC0 ABC2\",\"createdTime\":1490016216131,\"endDate\":null},{\"id\":\"15499\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15487\",\"processInstanceId\":\"15474\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for ABC0 ABC2\",\"createdTime\":1490012957315,\"endDate\":null},{\"id\":\"15473\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15456\",\"processInstanceId\":\"15441\",\"processDefinitionId\":\"editUser:21:13071\",\"description\":\"Edit User Lana Lana\",\"createdTime\":1489751356560,\"endDate\":null},{\"id\":\"15440\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15428\",\"processInstanceId\":\"15415\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for selfservice100 Test\",\"createdTime\":1489751296845,\"endDate\":null},{\"id\":\"15414\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15397\",\"processInstanceId\":\"15382\",\"processDefinitionId\":\"editUser:21:13071\",\"description\":\"Edit User Lana Lana\",\"createdTime\":1489750477418,\"endDate\":null},{\"id\":\"15381\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15369\",\"processInstanceId\":\"15356\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for selfservice100 Test\",\"createdTime\":1489750415750,\"endDate\":null},{\"id\":\"15355\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15338\",\"processInstanceId\":\"15323\",\"processDefinitionId\":\"editUser:21:13071\",\"description\":\"Edit User Lana Lana\",\"createdTime\":1489743964592,\"endDate\":null},{\"id\":\"15322\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15310\",\"processInstanceId\":\"15297\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for selfservice100 Test\",\"createdTime\":1489743896978,\"endDate\":null},{\"id\":\"15223\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15211\",\"processInstanceId\":\"15198\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for ABC0 ABC2\",\"createdTime\":1489673791299,\"endDate\":null},{\"id\":\"15124\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15112\",\"processInstanceId\":\"15099\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for ABC0 ABC2\",\"createdTime\":1489509875220,\"endDate\":null},{\"id\":\"15098\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15086\",\"processInstanceId\":\"15073\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for ABC0 ABC2\",\"createdTime\":1489506141134,\"endDate\":null},{\"id\":\"15072\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15055\",\"processInstanceId\":\"15040\",\"processDefinitionId\":\"editUser:21:13071\",\"description\":\"Edit User Lana Lana\",\"createdTime\":1489080806018,\"endDate\":null},{\"id\":\"15039\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vijaylakshmi.Iyer\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"15027\",\"processInstanceId\":\"15014\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for selfservice100 Test\",\"createdTime\":1489080741692,\"endDate\":null},{\"id\":\"14465\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vitaliya.Zhuravleva1\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"14453\",\"processInstanceId\":\"14440\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for testassos testassos\",\"createdTime\":1488446752391,\"endDate\":null},{\"id\":\"14439\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vitaliya.Zhuravleva1\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"14427\",\"processInstanceId\":\"14414\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for testassos testassos\",\"createdTime\":1488446700403,\"endDate\":null},{\"id\":\"14387\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"Vitaliya.Zhuravleva1\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"14375\",\"processInstanceId\":\"14362\",\"processDefinitionId\":\"newHireWithApprovalProcess:21:13083\",\"description\":\"New Hire Request for testassos testassos\",\"createdTime\":1488446555644,\"endDate\":null},{\"id\":\"14361\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"14349\",\"processInstanceId\":\"14336\",\"processDefinitionId\":\"selfRegistration:21:13075\",\"description\":\"Self Registration Request for ABC0 ABC2\",\"createdTime\":1488360545437,\"endDate\":null},{\"id\":\"13385\",\"hasChild\":false,\"beanType\":\"TaskWrapperBean\",\"name\":\"\",\"deletable\":true,\"parentTaskId\":null,\"executionId\":\"13370\",\"processInstanceId\":\"13355\",\"processDefinitionId\":\"newGroup:21:13069\",\"description\":\"Edit Group vTestGroup2\",\"createdTime\":1485780261709,\"endDate\":null}],\"emptySearchBean\":false}"
    #endif

    init(_ restApi: RestApi!) {
        self.restApi = restApi
    }

    func readAssignedTasks(completionHandler: @escaping (RestApi.RestResponse) -> Void) {
        restApi.apiCall(assignedTasksPath,
                        method: .get,
                        parameters: ["from": 0,
                                     "size": 20,
                                     "sortBy": "name",
                                     "orderBy": "ASC"]) { response in
                                        #if LNX2_WORKAROUND
                                            let response_from_lnx1 = LNX2_WORKAROUND
                                            response.json = JSON(response_from_lnx1)
                                        #endif
                                        
                                        if (response.json != nil) {
                                            //TODO: parse respnonse
                                        }
                                        completionHandler(response)
        }
    }
}
